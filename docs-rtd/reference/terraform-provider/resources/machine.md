---
# generated using template templates/resources/machine.md.tmpl
page_title: "juju_machine Resource - terraform-provider-juju"
subcategory: ""
description: |-
  A resource that represents a Juju machine deployment. Refer to the juju add-machine CLI command for more information and limitations.
---

# juju_machine (Resource)

A resource that represents a Juju machine deployment. Refer to the juju add-machine CLI command for more information and limitations.

## Example Usage
```terraform
resource "juju_machine" "this_machine" {
  model_uuid  = juju_model.development.uuid
  base        = "ubuntu@22.04"
  name        = "this_machine"
  constraints = "tags=my-machine-tag"

  # If you face timeouts destroying machines, add the following lifecycle
  # directive, which instructs Terraform to update any dependent resources
  # before destroying the machine - in the case of applications this means
  # that application units get removed from units before Terraform attempts
  # to destroy the machine.
  lifecycle {
    create_before_destroy = true
  }
}
```

<!-- schema generated by tfplugindocs -->
## Schema

### Required

- `model_uuid` (String) The Juju model's UUID to specify the model in which to add a new machine. Changing this value will cause the machine to be destroyed and recreated by terraform.

### Optional

- `annotations` (Map of String) Annotations are key/value pairs that can be used to store additional information about the machine. May not contain dots (.) in keys.
- `base` (String) The operating system to install on the new machine(s). E.g. ubuntu@22.04. Changing this value will cause the machine to be destroyed and recreated by terraform.
- `constraints` (String) Machine constraints that overwrite those available from 'juju get-model-constraints' and provider's defaults. Changing this value will cause the application to be destroyed and recreated by terraform.
- `disks` (String) Storage constraints for disks to attach to the machine(s). Changing this value will cause the machine to be destroyed and recreated by terraform.
- `name` (String) A name for the machine resource in Terraform.
- `placement` (String) Additional information about how to allocate the machine in the cloud. Changing this value will cause the application to be destroyed and recreated by terraform.
- `private_key_file` (String) The private key of the user who will be creating the ubuntu user.
- `public_key_file` (String) The public key to place under the ubuntu user's ~/.ssh/authorized_keys on the target machine.
- `ssh_address` (String) SSH Address is used to manually provision an existing machine via SSH. It should be in the format 'user@host'.

The 'user' must be an existing user on the machine. If the 'user' is not 'ubuntu' (i.e., root@host), the provider will attempt to 
create the 'ubuntu' user for Juju to use. If you wish for the provider to create the 'ubuntu' user, you must provide the 
'public_key_file', 'private_key_file', and 'ubuntu_user_private_key' attributes.

If the user is 'ubuntu' (i.e., ubuntu@host), the provider will use the existing 'ubuntu' user. In this mode, you must only
provide the 'ubuntu_user_private_key' attribute.

For clarity:
- 'public_key_file' is the public key that will be placed in the 'ubuntu' user's ~/.ssh/authorized_keys file.
- 'private_key_file' is the private key corresponding to the user who will be creating the 'ubuntu' user, i.e., root's private key.
- 'ubuntu_user_private_key' is the private key that will be used to connect to the machine as the 'ubuntu' user for provisioning and hardware checks.
	it is also the key that will be required to perform juju ssh.
- `timeouts` (Block, Optional) (see [below for nested schema](#nestedblock--timeouts))
- `ubuntu_user_private_key` (String, Sensitive) The private key to use when connecting to the machine as the ubuntu user for provisioning and hardware checks. It is used to verify the machine is reachable under the "ubuntu" user, to determine hardware characteristics and to run the provisioning script.Additionally, this is the user that will be used for SSH purposes, and this key is the ONLY way to SSH to the machine.
- `wait_for_hostname` (Boolean) If true, waits for the machine's hostname to be set during creation. A side effect is that this also waits for the machine to reach 'active' state in Juju.

### Read-Only

- `hostname` (String) The machine's hostname. This is set only if 'wait_for_hostname' is true.
- `id` (String) The ID of this resource.
- `machine_id` (String) The id of the machine Juju creates.

<a id="nestedblock--timeouts"></a>
### Nested Schema for `timeouts`

Optional:

- `create` (String) A string that can be [parsed as a duration](https://pkg.go.dev/time#ParseDuration) consisting of numbers and unit suffixes, such as "30s" or "2h45m". Valid time units are "s" (seconds), "m" (minutes), "h" (hours).

### Notes

Juju will automatically remove a machine if all application units deployed to that machine are removed.


## Import

Import is supported using the following syntax:

```shell
# Machines can be imported using the format: `model_uuid:machine_id:machine_name`.
# The value of machine_id is the Juju Machine ID. machine_name is an optional 
# name you can define in Terraform for the machine. It is not used in Juju.
# Here is an example to import a machine from a model with machine ID 1 and a 
# name "machine_one":
$ terraform import juju_machine.machine_one 4ffb2226-6ced-458b-8b38-5143ca190f75:1:machine_one
```
